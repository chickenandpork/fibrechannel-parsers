AT_INIT()


AT_SETUP(Alias4File Parser)
dnl      -----------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,NetApp-123456,Storage
"WWN",10:00:00:00:c9:12:34:56,Oracle01,Server
"WWN",10:00:00:00:c9:12:34:57,Oracle01,Server
])

AT_CHECK([java -Ddebug.verboseTokenizer=ALias4Parser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.Alias4Parser < alias4file.csv ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=Alias4Parser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.Alias4Parser < alias4file.csv ], 0, [Parse results for Alias4Parser:
Zones: 0
Aliases: 4 (names with one or more WWPNs)
Aliases: 4 (name/WWPN pairs)
Alias: 50:0a:09:85:98:12:34:56, NetApp-123456
Alias: 50:0a:09:86:98:12:34:56, NetApp-123456
Alias: 10:00:00:00:c9:12:34:56, Oracle01
Alias: 10:00:00:00:c9:12:34:57, Oracle01
], [stderr])

AT_CLEANUP()


AT_SETUP(Brocade alishow Parser)
dnl      ----------------------

AT_CHECK([java -Ddebug.verboseTokenizer=AliShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple.zoneshow ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=AliShowZoneParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple.zoneshow ], 0, [Parse results for AliShowZoneParser:
Zones: 4
Aliases: 11 (names with one or more WWPNs)
Aliases: 16 (name/WWPN pairs)
Alias: 50:06:0e:80:12:34:57:24, HDS0123457_CL3E
Alias: 50:06:0e:80:12:34:57:25, HDS0123457_CL3F
Alias: 50:06:0e:80:12:34:57:44, HDS0123457_CL5E
Alias: 50:06:0e:80:12:34:57:45, HDS0123457_CL5F
Alias: 50:06:0e:80:12:34:57:64, HDS0123457_CL7E
Alias: 50:06:0e:80:12:34:57:65, HDS0123457_CL7F
Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 10:00:00:00:c9:44:44:10, NASMany_654321
Alias: 10:00:00:00:c9:44:44:11, NASMany_654321
Alias: 10:00:00:00:c9:44:44:20, NASMany_654321
Alias: 10:00:00:00:c9:44:44:21, NASMany_654321
Alias: 10:00:00:00:c9:44:44:30, NASMany_654321
Alias: 10:00:00:00:c9:44:44:31, NASMany_654321
], [stderr])

AT_CLEANUP()


AT_SETUP(alishow Double cfg Block)
dnl      ----------------------

AT_CHECK([java -Ddebug.verboseTokenizer=AliShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple-multicfg.zoneshow ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=AliShowZoneParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple-multicfg.zoneshow ], 0, [Parse results for AliShowZoneParser:
Zones: 4
Aliases: 11 (names with one or more WWPNs)
Aliases: 16 (name/WWPN pairs)
Alias: 50:06:0e:80:12:34:57:24, HDS0123457_CL3E
Alias: 50:06:0e:80:12:34:57:25, HDS0123457_CL3F
Alias: 50:06:0e:80:12:34:57:44, HDS0123457_CL5E
Alias: 50:06:0e:80:12:34:57:45, HDS0123457_CL5F
Alias: 50:06:0e:80:12:34:57:64, HDS0123457_CL7E
Alias: 50:06:0e:80:12:34:57:65, HDS0123457_CL7F
Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 10:00:00:00:c9:44:44:10, NASMany_654321
Alias: 10:00:00:00:c9:44:44:11, NASMany_654321
Alias: 10:00:00:00:c9:44:44:20, NASMany_654321
Alias: 10:00:00:00:c9:44:44:21, NASMany_654321
Alias: 10:00:00:00:c9:44:44:30, NASMany_654321
Alias: 10:00:00:00:c9:44:44:31, NASMany_654321
], [stderr])

AT_CLEANUP()



AT_SETUP(alishow Ignore Hard-Zoning)
dnl      --------------------------

AT_CHECK([java -Ddebug.debugTokenizer=AliShowZoneParser -Ddebug.verboseTokenizer=AliShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple-hardzone.zoneshow ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=AliShowZoneParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < abs_top_srcdir/samples/simple-hardzone.zoneshow ], 0, [Parse results for AliShowZoneParser:
Zones: 5
Aliases: 11 (names with one or more WWPNs)
Aliases: 16 (name/WWPN pairs)
Alias: 50:06:0e:80:12:34:57:24, HDS0123457_CL3E
Alias: 50:06:0e:80:12:34:57:25, HDS0123457_CL3F
Alias: 50:06:0e:80:12:34:57:44, HDS0123457_CL5E
Alias: 50:06:0e:80:12:34:57:45, HDS0123457_CL5F
Alias: 50:06:0e:80:12:34:57:64, HDS0123457_CL7E
Alias: 50:06:0e:80:12:34:57:65, HDS0123457_CL7F
Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 10:00:00:00:c9:44:44:10, NASMany_654321
Alias: 10:00:00:00:c9:44:44:11, NASMany_654321
Alias: 10:00:00:00:c9:44:44:20, NASMany_654321
Alias: 10:00:00:00:c9:44:44:21, NASMany_654321
Alias: 10:00:00:00:c9:44:44:30, NASMany_654321
Alias: 10:00:00:00:c9:44:44:31, NASMany_654321
], [stderr])

AT_CLEANUP()



dnl Alias4Parser.java:public class Alias4Parser extends ZoneParser
dnl BNAZoneParser.java:public class BNAZoneParser
dnl DeviceAliasParser.java:public class DeviceAliasParser

AT_SETUP(alishow Regression First WWPN Missed)

AT_DATA([multiWWPN.zoneshow], [Defined configuration:
 cfg:   SAN_CFG_A
 cfg:   SAN_CFG_B
 alias: NASMany_654321
                10:00:00:00:c9:44:44:10; 10:00:00:00:c9:44:44:11
                10:00:00:00:c9:44:44:20; 10:00:00:00:c9:44:44:21
                10:00:00:00:c9:44:44:30; 10:00:00:00:c9:44:44:31
])

AT_CHECK([java -Ddebug.verboseAppendZone=AliShowZoneParser -Ddebug.verboseAddZone=AliShowZoneParser -Ddebug.dumpAliases=AliShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.AliShowZoneParser < multiWWPN.zoneshow ], 0, [append: list.sval: 10:00:00:00:c9:44:44:31
append: list.obj: NULL
append: item.sval: 10:00:00:00:c9:44:44:30
append: item.obj: NULL
append: list.sval: NULL
append: list.obj: java.util.Vector
append: item.sval: 10:00:00:00:c9:44:44:21
append: item.obj: NULL
append: list.sval: NULL
append: list.obj: java.util.Vector
append: item.sval: 10:00:00:00:c9:44:44:20
append: item.obj: NULL
append: list.sval: NULL
append: list.obj: java.util.Vector
append: item.sval: 10:00:00:00:c9:44:44:11
append: item.obj: NULL
append: list.sval: NULL
append: list.obj: java.util.Vector
append: item.sval: 10:00:00:00:c9:44:44:10
append: item.obj: NULL
Parse results for AliShowZoneParser:
Zones: 0
Aliases: 1 (names with one or more WWPNs)
Aliases: 6 (name/WWPN pairs)
Alias: 10:00:00:00:c9:44:44:10, NASMany_654321
Alias: 10:00:00:00:c9:44:44:11, NASMany_654321
Alias: 10:00:00:00:c9:44:44:20, NASMany_654321
Alias: 10:00:00:00:c9:44:44:21, NASMany_654321
Alias: 10:00:00:00:c9:44:44:30, NASMany_654321
Alias: 10:00:00:00:c9:44:44:31, NASMany_654321
], [])

AT_CLEANUP()



AT_SETUP(Cisco device-alias Parser)
dnl      -------------------------

AT_CHECK([java -Ddebug.verboseTokenizer=DeviceAliasParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.DeviceAliasParser < abs_top_srcdir/samples/simple.devicealias ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=DeviceAliasParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.DeviceAliasParser < abs_top_srcdir/samples/simple.devicealias ], 0, [stdout], [stderr])
AT_CHECK([sort stdout], 0, [Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 50:06:0e:80:12:34:56:24, HDS0123456_CL3E
Alias: 50:06:0e:80:12:34:56:25, HDS0123456_CL3F
Alias: 50:06:0e:80:12:34:56:44, HDS0123456_CL5E
Alias: 50:06:0e:80:12:34:56:45, HDS0123456_CL5F
Alias: 50:06:0e:80:12:34:56:64, HDS0123456_CL7E
Alias: 50:06:0e:80:12:34:56:65, HDS0123456_CL7F
Alias: 50:06:0e:80:12:34:56:6e, HDS0123456_CL7P
Alias: 50:06:0e:80:12:34:56:6f, HDS0123456_CL7Q
Aliases: 12 (name/WWPN pairs)
Aliases: 12 (names with one or more WWPNs)
Parse results for DeviceAliasParser:
Zones: 0
], [stderr])

AT_CLEANUP()



AT_SETUP(Cisco showzone Parser)
dnl      ---------------------

AT_CHECK([java -Ddebug.verboseTokenizer=ShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.ShowZoneParser < abs_top_srcdir/samples/simple.shzone ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=ShowZoneParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.ShowZoneParser < abs_top_srcdir/samples/simple.shzone ], 0, [stdout], [stderr])
AT_CHECK([sort stdout], 0, [Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 50:06:0e:80:12:34:56:78, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:79, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7a, SANASVR003_FabA
Alias: 50:06:0e:80:12:34:56:7b, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7c, vclprFpdc01_hba2_A1
Alias: 50:06:0e:80:12:34:56:7d, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7e, vclprFpdc01_hba2_A1
Alias: 50:06:0e:80:12:34:56:7f, HDS0123457_CL7F
Aliases: 12 (name/WWPN pairs)
Aliases: 12 (names with one or more WWPNs)
Parse results for ShowZoneParser:
Zones: 0
], [stderr])

AT_CHECK([echo 'switchname#sh zone' > work], 0, [], [])
AT_CHECK([cat abs_top_srcdir/samples/simple.shzone >> work], 0, [], [])
AT_CHECK([java -Ddebug.verboseTokenizer=ShowZoneParser -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.ShowZoneParser < work ], 0, [stdout], [stderr])
AT_CHECK([java -Ddebug.dumpAliases=ShowZoneParser      -cp $abs_top_builddir/java/fcparsers.jar org.smallfoot.parser.zone.ShowZoneParser < work ], 0, [stdout], [stderr])
AT_CHECK([sort stdout], 0, [Alias: 10:00:00:00:c9:12:34:66, Oracle_123466
Alias: 10:00:00:00:c9:12:34:67, Oracle_123467
Alias: 10:00:00:00:c9:12:34:68, NASHead_123468
Alias: 10:00:00:00:c9:12:34:69, NASHead_123469
Alias: 50:06:0e:80:12:34:56:78, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:79, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7a, SANASVR003_FabA
Alias: 50:06:0e:80:12:34:56:7b, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7c, vclprFpdc01_hba2_A1
Alias: 50:06:0e:80:12:34:56:7d, HDS0123457_CL7F
Alias: 50:06:0e:80:12:34:56:7e, vclprFpdc01_hba2_A1
Alias: 50:06:0e:80:12:34:56:7f, HDS0123457_CL7F
Aliases: 12 (name/WWPN pairs)
Aliases: 12 (names with one or more WWPNs)
Parse results for ShowZoneParser:
Zones: 0
], [stderr])

AT_CLEANUP()



AT_SETUP(User-given bnazone testcase)
dnl      ---------------------------

AT_CHECK([if test @USERBNATESTCASE@ = missing ; then exit 77; fi])
AT_CHECK([java -cp $abs_srcdir/../java/bld org.smallfoot.parser.boneheadbits.Select2Sample < @USERBNATESTCASE@], 0, [stdout], [])
AT_CHECK([java -cp $abs_srcdir/../java/bld org.smallfoot.parser.BNAZoneParser < stdout], 0, [], [])

AT_CLEANUP()



AT_SETUP(Doxygen confirmation of marked-up content)
dnl      -----------------------------------------

AT_CHECK([if test @DOXYGEN@ = missing ; then exit 77; fi])
AT_CHECK([make -C $abs_srcdir/.. doc], 0, [ignore],[stderr])
dnl used to put the errors at the bottom of the output
AT_CHECK([cat stderr], 0, [],[])

AT_CLEANUP()


